\chapter{Calibration and data acquisition development}
\label{chap:Calibration}


\section{TestBed calibration}
\label{sec:calibration:TestBed-calibration}

Askaryan radiation from UHE neutrino-induced particle cascades results in short duration bipolar signals. These impulses typically extend over $\sim 100 \pico \second$ and result from coherent emission of frequencies up to $500 \mega \hertz$ to $1 \giga \hertz$. In order to make measurements of such signals it is not only necessary to use antennas with the necessary bandwidth, but also to be able to sample and digitise their output with appropriate fidelity. 


This section will describe the need for, and details of, a number of timing calibrations that were performed on the digitisation chain in the TestBed.

In addition to providing high quality waveforms for neutrino events 




The strict power and cost requirements of ARA necessitate the use of application specific integrated circuit (ASIC) digitisers that fulfill these criteria. The majority of recorded signals that trigger ARA stations are expected to be from thermal or anthropogenic sources and are considered backgrounds to detection of neutrino signals. Timing differences between the same signal being observed in multiple antennas can be used to reconstruct the physical location of their source. In \SectionRef{chap:Analysis} it will be shown that reconstruction can provide a powerful tool with which to separate interesting signals from these backrounds. 


\subsection{TestBed timing calibrations}
\label{sec:calibration:LABRADOR-Digitiser-Chip}

The TestBed digitises waveforms using three LABRADOR (Large Analogue Bandwidth Recorded And Digitizer with Ordered Readout) chips designed at the Instrument and Design Laboratory, University of Hawaii. Each chip has 9 parallel radio frequency (RF) input channels that are continuously sampled. These samples are digitised in place once read out is initiated by the data acqusition (DAQ). Sampling, digitisation and readout of samples is controlled by signals from a field programmable gate array (FPGA) in the DAQ. A number of timing related calibrations are necessary due to the properties of the LABRADOR chip and its implementation in the TestBed. 

\begin{figure}[htpb]
  \includegraphics[width=\hugefigwidth]{chapters/calibration/LAB3_archictecture.pdf}
  \caption{The overall architecture of the LABRADOR digitser from \cite{Varner2007447}.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Architecture}
\end{figure}

\FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Architecture} shows the architecture of the LABRADOR chip used in the TestBed. On each chip a switched capacitor array (SCA) of 260 sampling capacitors per channel is used to sample the input voltage values. Sampling is controlled by a write signal, which is common to all 9 channels, driven by an externally provided clock. When a stop signal is asserted by the DAQ the samples are digitised in place using a Wilkinson analogue to digital converter (ADC), which occurs in parallel for all samples on all channels. Once digitisation is complete the digitised voltage values are requested by the DAQ and read out on a 12-bit data bus and processed by the FPGA for packetisation and recording as an event for later analysis.

\begin{figure}[htpb]
  \includegraphics[width=\hugefigwidth]{chapters/calibration/LAB3_RCO_Schmatic.pdf}
  \caption{A schematic of the sampling within the LABRADOR digitiser from \cite{Varner2007447}.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Schematic}
\end{figure}


To acheive continuous sampling voltage samples are stored in the SCA as the write signal propogates along the array. The time taken for the write signal to propogate between adjacent samples varies from sample to sample and from digitiser to digitiser. These `inter-sample' times must be estimated from known input signals and a calibration applied to correct the time base of recorded waveforms. The voltage sampling is illustrated in \FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Schematic}. The write pointer signal propogates along the array in one of two phases, Ripple Carry Out (RCO) 0 and RCO1. The transit time of the write signal between adjacent samples differs between these two phases hence calibrated inter-sample times must be calculated for each.

In order to continue sampling once the write signal reaches the end of the SCA the write pointer wraps back to the first sample, at which time the RCO phase changes. This wrapping means the SCA functions as a ring, continously sampling voltage values and over-writing the oldest sample taken. When a stop request is received, to initiate digitisation and read out, the chip issues a `HITBUS' causing the chip to stop sampling. The HITBUS removes around 8 samples from the waveform, which have their voltage value corrupted due to the change in state of the chip. The capacitor immediately after the HITBUS is the earliest sample in the resulting waveform, and the capacitor immediately before the HITBUS is the lastest sample. 

The physical distance travelled when wrapping the write pointer is much greater than between adjacent samples so, to avoid time gaps in the resulting waveforms, the write pointer begins wrapping at the $255^{th}$ sample. The remaining 4 samples, 256-259, are then used to fill in the resulting gap in time between the $255^{th}$ and $0^{th}$ samples.  The time taken for the write pointer to wrap, referred to as the `wrap-around', is another quantity that needs to be estimated and accounted for in calibration, which again varies from chip to chip and between RCO phases.


One of the features of the LABRADOR chip is the ability to operate at a range of sampling speeds. For the TestBed implementation it is operated at a nominal sampling speed of $1 \giga \mbox{Sample} /\second$ which corresponds to a Nyquist frequency \footnote{The Nyquist frequency for a discretely sampled system indicates the maximum resolveable input frequency and is equal to half the sample rate.} of $500 \mega \hertz$. The borehole antennas have good response to frequencies up to $850 \mega \hertz$, which means that frequency content would be lost if these antennas had their signals input to a single channel each. In order to retain this high frequency content each of these antennas has its signal split and inserted into a pair of input channels, one offset from the other by $0.5 \nano \second$. This interleaving process leads to an effective doubling of the sampling speed for the borehole antennas, however the offset needs to be calibrated out in order to accurately reconstruct the original input waveforms. 

As well as ensuring the timing information, on a per antenna basis, is as accurate as possible it is also necessary to correct for any offsets between channels. Due to the use of a common write signal each of the channels on a single chip will be aligned once the inter-sample, wrap-around and interleave calibrations are carried out. This is not true for channels on different chips and must be addressed in the final timing calibration, inter-chip jitter removal. Since timing differences between similar signals in pairs of antennas serves as the basis of event reconstruction this calibration is an integral part of distinguishing between noise sources and potential neutrino induced signals. 

\subsubsection{Inter-sample times}
\label{sec:calibration:LABRADOR-Digitiser-Chip:Inter-sample-times}

The inter-sample times correspond to the time taken for the LABRADOR digitiser's write pointer to propogate between samples. By adjusting control voltages to the chip the global sampling speed can be adjusted, which acts by effecting a change to each of the inter-sample times. Using the selected operating parameters of the chips in the TestBed DAQ a series of dedicated calibration runs were taken in the northern hemisphere prior to deployment in Antarctica. For each of these runs, each containing many thousands of events,  precise frequency sinusoidal inputs were provided to the DAQ box were taken and used to calculate the various timing calibrations necessary for the TestBed. 

Standard sampling calibration techniques were used to estimate the inter-sample times. The number of zero-crossings between a pair of adjacent samples was scaled by the number of waveforms in which that sample was present. The resulting fractional zero-crossing occupancy is then scaled by half the period of the input sine wave to recover the inter-sample time:

\begin{itemize}
\item The voltage values of each waveform are zero-meaned 
\item The RCO phase of each pair of adjacent samples is then determined as described in section something %FIXME
\item The total number of times zero is crossed between each pair of samples is counted over the run (i.e. the voltage goes from positive to negative, or visa-versa, between a pair of samples)
\item The total number of zero-crossings is then divided by the total number of events for which that pair of samples were active
\item This fractional zero-crossing occupancy is then scaled by the half-period of the input sine-wave, resulting in an estimate for the inter-sample times
\end{itemize}


The resulting distribution of inter-sample times is shown in \FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Inter-sample-times}. 

\begin{figure}[htpb]
  \subfloat[All RCO phases]{\includegraphics[width=0.49\textwidth]{chapters/calibration/TB-LAB3-DT-All.pdf}}\\
  \subfloat[RCO 0]{\includegraphics[width=0.49\textwidth]{chapters/calibration/TB-LAB3-DT-RCO0.pdf}}\hfill
  \subfloat[RCO 1]{\includegraphics[width=0.49\textwidth]{chapters/calibration/TB-LAB3-DT-RCO1.pdf}}
  \caption{Calculated inter-sample times for all 3 TestBed LABRADOR digitisers. In (a) both RCO phases are included, whereas (b) and (c) show the distributions for RCO phase 0 and 1 respectively.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Inter-sample-times}
\end{figure}

\subsubsection{Wrap-around times}
\label{sec:calibration:LABRADOR-Digitiser-Chip:Wrap-around-times}

The time taken to wrap between the end and beginning of the SCA, denoted $\varepsilon_{0}$ and $\varepsilon_{1}$ for the two RCO phases, is considerably larger than the inter-sample times. Rather than measuring the scaled zero-crossing occupancy, as described in \SectionRef{sec:calibration:LABRADOR-Digitiser-Chip:Inter-sample-times}, sine waves are fitted to the waveform before and after the wrap-around. By aligning the phase of the two fitted sine waves it is possible to estimate the wrap-around time. The full procedure is as follows:

\begin{itemize}
\item The voltage values of each waveform are zero-meaned
\item Only events containing at least 20 samples before and after the wrap-around are selected
\item Calibrated inter-sample times, calculated as described in \SectionRef{sec:calibration:LABRADOR-Digitiser-Chip:Inter-sample-times}, are applied to the waveform 
\item Sine waves are fitted to the last 20 samples before the wrap-around, and first 20 samples after
\item The fitted sine wave after the wrap-around is moved in time until the phase matches that before the wrap-around
\item The wrap-around time is then taken to be the time between sample 255 and sample 0, and is averaged over a calibration run
\end{itemize}


\begin{figure}[htpb]
  \subfloat[RCO 0]{\includegraphics[width=0.49\textwidth]{chapters/calibration/Wrap-Around-Chip1-RCO0.pdf}}\hfill
  \subfloat[RCO 1]{\includegraphics[width=0.49\textwidth]{chapters/calibration/Wrap-Around-Chip1-RCO1.pdf}}
  \caption{Estimated wrap-around times for all events in a calibration run for TestBed LABRADOR chip 0 and both RCO phases. The average value is taken over all events in the run.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Wrap-around}
\end{figure}


\subsubsection{Interleaving}
\label{sec:calibration:LABRADOR-Digitiser-Chip:Interleaving}

To increase the effective sampling rate of the borehole antennas the signals from each of them are fed into two digitiser channels, one offset from the other by approximately half a sample. The resulting waveforms are then produced by interleaving the two digitised channels for each of these antennas. A calibration is performed to estimate the offset between each pair of channels that have their signals split, such that the resulting interleaved waveforms are as accurate as possible. This is achieved by attempting to align the phase of input sine waves between these pairs of channels as follows:

\begin{itemize}
\item The voltage values of each waveform are zero-meaned
\item Inter-sample and wrap-around calibrations are applied to each channel's waveforms
\item A sine wave is fitted to each pair of split channels
\item The phase offset between each pair of fitted sine waves is recorded
\item The interleave offset for a pair of channels is taken to be the mean phase offset over a run of calibration data
\end{itemize}

The interleave offsets for two pairs of channels are shown in \FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Interleave}. The calculated offsets are close to half the average inter-sample times resulting in an increase in Nyquist cut-off from $500 \mega\hertz$ to $1\giga\hertz$ for the affected channels.

\begin{figure}[htpb]
  \subfloat[Chip 1 Pair 1]{\includegraphics[width=0.49\textwidth]{chapters/calibration/Interleave-Chip1-Pair1.pdf}}\hfill
  \subfloat[Chip 1 Pair 2]{\includegraphics[width=0.49\textwidth]{chapters/calibration/Interleave-Chip1-Pair2.pdf}}
  \caption{Interleave times.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Interleave}
\end{figure}


\subsubsection{Inter-chip jitter correction}
\label{sec:calibration:LABRADOR-Digitiser-Chip:Inter-chip-jitter-correction}

The three LABRADOR digitiser chips used in the TestBed are operated in parallel using the same control signals. Each of the 3 digitisers has a clock signal input into one RF channel that is digitised along with the inputs from the signal chain. These clock signals are used to remove event-to-event jitter of the trigger signals that start digitisation and readout of the SCAs. Using the clock channel it is possible to estimate the phase of the clock signal in each LABRADOR chip. A timing correction is calculated to align the phase of the clocks accross all three digitisers and is then applied to all waveforms.

\begin{figure}[htpb]
  \includegraphics[width=0.49\textwidth]{chapters/calibration/lagAlagBAllNewCuts_updated_labels_resize_regions_labelled.pdf}
  \caption{The measured clock channel phase relative to the first sample in LABRADOR chips 1 and 2. Events in region A are interpreted as needing $25 \nano \second$ (1 clock period) added to the phase in chip 2, in region D $25 \nano \second$ added to the phase in chip 1 and in region C $25 \nano \second$ added to the phase in both chips 1 and 2.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Swiss-flag}
\end{figure}

In \FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Swiss-flag} the measured phase of the clock channel, relative to the first sample, in two LABRADOR chips are plotted against each other. A feature of the TestBed implementation of the LABRADOR digitiser is that there are regions in this parameter space that are not or under-populated. This feature is used to resolve period ambiguity between the two chips which would otherwise result in an additional $\pm 25 \nano \second$ (1 clock period) offset between the time base in waveforms recorded in different LABRADOR chips.

\subsubsection{RCO phase determination}
\label{sec:calibration:LABRADOR-Digitiser-Chip:RCO-phase-determination}






\subsubsection{Calibration results}
\label{sec:calibration:LABRADOR-Digitiser-Chip:Calibration-results}

Each of the timing calibrations has an effect on the reconstruction of the source location of waveforms recorded in the TestBed. In \SectionRef{sec:Analysis:Reconstruction} a method will be described for reconstruction which is reliant upon precise measurements of the timing offsets between the same signal being observed in multiple antennas. The cumulative effect of the timing calibrations described can be seen in \FigureRef{fig:calibration:LABRADOR-Digitiser-Chip:Timing-Differences} where timing offsets between a pair of antennas are calculated using correlation techniques.

\begin{figure}[htpb]
  \subfloat[Calibrated waveforms]{\includegraphics[width=0.49\textwidth]{chapters/calibration/deltaT-VPol-Ant1-4-Calibrated.pdf}}\hfill
  \subfloat[Uncalibrated waveforms]{\includegraphics[width=0.49\textwidth]{chapters/calibration/deltaT-VPol-Ant1-4-Uncalibrated.pdf}}
  \caption{Timing offsets for a month of calibration pulser events for (a) timing calibrated and (b) uncalibrated waveforms. The antennas used are vertically polarised (VPol) receiving signals from a calibration pulser connected to a VPol transmit antenna buried close to the TestBed detector.}
  \label{fig:calibration:LABRADOR-Digitiser-Chip:Timing-Differences}
\end{figure}

The timing calibration with the largest affect is the inter-chip jitter removal, which corrects for offsets up to $25 \nano \second$ between waveforms recorded on different LABRADOR chips. A shift in the measured mean time offset between the antennas is caused by application of cable delays, which account for the differing lengths of cable that signals must propagate through when travelling from the receive antenna to the digitiser. After application of all timing calibrations the resolution on time offsets between antennas is $\sim 100 \pico \second$.


\subsection{Voltage reversal}
\label{sec:calibration:Voltage-reversal}

Close to finalisation of the analysis presented in \ChapterRef{chap:Analysis} a reversal of voltage values recorded in two of the horizontally polarised (HPol) antennas' waveforms was identified. This reversal is illustrated in \FigureRef{fig:calibration:Voltage-Reversal} where hundreds of calibration pulser signals originating from the HPol calibration pulser are averaged to remove thermal noise. There is a clear inversion of voltage values for antennas 3 and 4 compared with antennas 1 and 2. It is believed that this flip originates from installation of the antennas upside down relative to antennas 1 and 2, or from inversion of voltages during amplification in the signal chain. 

\begin{figure}[htpb]
  \subfloat[Antenna 1]{\includegraphics[width=0.49\textwidth]{chapters/calibration/avWaveformHPolAnt1.pdf}}\hfill
  \subfloat[Antenna 2]{\includegraphics[width=0.49\textwidth]{chapters/calibration/avWaveformHPolAnt2.pdf}}\\
  \subfloat[Antenna 3]{\includegraphics[width=0.49\textwidth]{chapters/calibration/avWaveformHPolAnt3.pdf}}\hfill
  \subfloat[Antenna 4]{\includegraphics[width=0.49\textwidth]{chapters/calibration/avWaveformHPolAnt4.pdf}}
\caption{Averaged waveforms from HPol borehole antennas. The signal captured is from the HPol calibration pulser operated in 2012. There is a clear inversion of voltage values in antennas 3 and 4 compared with antennas 1 and 2.}
\label{fig:calibration:Voltage-Reversal}
\end{figure}


Checks were made on the vertically polarised (VPol) antenna's waveforms from VPol calibration pulser events. No such inversion was found for these antennas. A correction was applied in the analysis described in \ChapterRef{chap:analysis} that switches positive for negative (and visa versa) voltages for the affected HPol antennas, resulting in a significant improvement in the reconstruction of calibration signals. 

\begin{figure}[htpb]
  \subfloat[With voltage reversal correction]{\includegraphics[width=0.49\textwidth]{chapters/calibration/DeltaT-HPol-1-4-Flip.pdf}}\hfill
  \subfloat[Without voltage reversal correction]{\includegraphics[width=0.49\textwidth]{chapters/calibration/DeltaT-HPol-1-4.pdf}}
\caption{The offset between HPol calibration pulser signals recorded in HPol antennas 1 and 4. The offset is measured by taking the time-offset corresponding to maximum correlation between the received signals. The offset is shown with (a) and without (b) correction for the voltage reversal found in antennas 3 and 4.}
\label{fig:calibration:Voltage-Reversal-DeltaT}
\end{figure}



\section{ARA 1-3 data acquisition development}
\label{sec:calibration:ARA1-3-development}

During this PhD work was carried out developing the DAQ for the first 3 full ARA stations, ARA 1-3. The DAQ installed for the TestBed differs significantly from that developed and deployed for ARA 1-3. A new digitiser, the Ice Ray Sampler (IRS2), was used in place of the LABRADOR digitiser. To accomodate the new digitiser a new suite of electronics boards were also designed and developed. 


 The IRS2 provides 8 radio frequency (RF) inputs and is operated at a sampling speed of $3.2 \giga \mbox{Sample} /\second$, placing the Nyquist frequency well above the maximum frequencies anticipated from neutrino induced signals. 


In addition to the increased sampling speed the IRS2 features analogue buffering of sampled signals. The IRS2 contains 2 blocks of 64 capacitor sampling cells along with 512 analogue storage blocks for buffering sampled signals. Once every $20 \nano \second$ one of the 2 blocks of sampling cells is transferred to the storage buffer whilst sampling of the RF signal continues in the other block. When a trigger condition is met the relevant analogue storage blocks are requested, digitised and read out, whilst sampling and buffering to the remaining storage blocks continues. 

\begin{figure}[htpb]
  \subfloat[Uncalibrated waveform]{\includegraphics[width=0.49\textwidth]{chapters/calibration/DDA1_Channel6_NoCalibration.pdf}}\hfill
  \subfloat[Calibrated waveform]{\includegraphics[width=0.49\textwidth]{chapters/calibration/DDA1_Channel6_Calibrated.pdf}}
\end{figure}









